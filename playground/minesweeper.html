<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>„Éû„Ç§„É≥„Çπ„Ç§„Éº„Éë„Éº</title>
    <style>
        body {
            font-family: 'Meiryo', sans-serif;
            text-align: center;
            margin: 20px;
            background: #c0c0c0;
        }
        h1 { margin: 10px 0; }
        #info {
            display: flex;
            justify-content: center;
            gap: 40px;
            margin: 10px 0;
            font-size: 20px;
            font-weight: bold;
        }
        #info span { color: #d00; }
        #board {
            display: inline-grid;
            grid-template-columns: repeat(9, 32px);
            gap: 1px;
            background: #808080;
            border: 3px solid;
            border-color: #fff #808080 #808080 #fff;
            padding: 3px;
        }
        .cell {
            width: 32px;
            height: 32px;
            font-size: 16px;
            font-weight: bold;
            line-height: 32px;
            text-align: center;
            cursor: pointer;
            background: #c0c0c0;
            border: 2px solid;
            border-color: #fff #808080 #808080 #fff;
            user-select: none;
        }
        .cell.revealed {
            border: 1px solid #808080;
            background: #d0d0d0;
            cursor: default;
        }
        .cell.mine { background: #f00; }
        .cell.flagged::after { content: "üö©"; }
        .c1 { color: #0000ff; }
        .c2 { color: #008000; }
        .c3 { color: #ff0000; }
        .c4 { color: #000080; }
        .c5 { color: #800000; }
        .c6 { color: #008080; }
        .c7 { color: #000000; }
        .c8 { color: #808080; }
        #message {
            margin: 15px 0;
            font-size: 24px;
            font-weight: bold;
            min-height: 32px;
        }
        button {
            padding: 10px 30px;
            font-size: 18px;
            font-family: 'Meiryo', sans-serif;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <h1>„Éû„Ç§„É≥„Çπ„Ç§„Éº„Éë„Éº</h1>
    <div id="info">
        <div>üí£ <span id="mineCount">10</span></div>
        <div>‚è± <span id="timer">0</span>Áßí</div>
    </div>
    <div id="board"></div>
    <div id="message"></div>
    <button onclick="initGame()">„É™„Çª„ÉÉ„Éà</button>

    <script>
        const ROWS = 9, COLS = 9, MINES = 10;
        let grid, revealed, flagged, gameOver, timerInterval, seconds;

        function initGame() {
            clearInterval(timerInterval);
            seconds = 0;
            revealed = 0;
            flagged = 0;
            gameOver = false;
            document.getElementById('timer').textContent = '0';
            document.getElementById('mineCount').textContent = MINES;
            document.getElementById('message').textContent = '';
            timerInterval = null;

            // Initialize grid
            grid = [];
            for (let r = 0; r < ROWS; r++) {
                grid[r] = [];
                for (let c = 0; c < COLS; c++) {
                    grid[r][c] = { mine: false, revealed: false, flagged: false, count: 0 };
                }
            }

            // Place mines
            let placed = 0;
            while (placed < MINES) {
                const r = Math.floor(Math.random() * ROWS);
                const c = Math.floor(Math.random() * COLS);
                if (!grid[r][c].mine) {
                    grid[r][c].mine = true;
                    placed++;
                }
            }

            // Calculate neighbor counts
            for (let r = 0; r < ROWS; r++) {
                for (let c = 0; c < COLS; c++) {
                    if (grid[r][c].mine) continue;
                    let count = 0;
                    for (let dr = -1; dr <= 1; dr++) {
                        for (let dc = -1; dc <= 1; dc++) {
                            const nr = r + dr, nc = c + dc;
                            if (nr >= 0 && nr < ROWS && nc >= 0 && nc < COLS && grid[nr][nc].mine) {
                                count++;
                            }
                        }
                    }
                    grid[r][c].count = count;
                }
            }

            renderBoard();
        }

        function renderBoard() {
            const board = document.getElementById('board');
            board.innerHTML = '';
            for (let r = 0; r < ROWS; r++) {
                for (let c = 0; c < COLS; c++) {
                    const cell = document.createElement('div');
                    cell.className = 'cell';
                    cell.addEventListener('click', () => reveal(r, c));
                    cell.addEventListener('contextmenu', e => {
                        e.preventDefault();
                        toggleFlag(r, c);
                    });
                    cell.id = `cell-${r}-${c}`;
                    board.appendChild(cell);
                }
            }
        }

        function startTimer() {
            if (timerInterval) return;
            timerInterval = setInterval(() => {
                seconds++;
                document.getElementById('timer').textContent = seconds;
            }, 1000);
        }

        function reveal(r, c) {
            if (gameOver) return;
            const cell = grid[r][c];
            if (cell.revealed || cell.flagged) return;

            startTimer();

            if (cell.mine) {
                // Game over
                gameOver = true;
                clearInterval(timerInterval);
                cell.revealed = true;
                revealAllMines();
                document.getElementById('message').textContent = 'üí• „Ç≤„Éº„É†„Ç™„Éº„Éê„ÉºÔºÅ';
                return;
            }

            // Flood fill for empty cells
            const stack = [[r, c]];
            while (stack.length > 0) {
                const [cr, cc] = stack.pop();
                if (cr < 0 || cr >= ROWS || cc < 0 || cc >= COLS) continue;
                const current = grid[cr][cc];
                if (current.revealed || current.mine || current.flagged) continue;

                current.revealed = true;
                revealed++;
                const el = document.getElementById(`cell-${cr}-${cc}`);
                el.classList.add('revealed');
                if (current.count > 0) {
                    el.textContent = current.count;
                    el.classList.add(`c${current.count}`);
                } else {
                    // Empty cell: expand neighbors
                    for (let dr = -1; dr <= 1; dr++) {
                        for (let dc = -1; dc <= 1; dc++) {
                            stack.push([cr + dr, cc + dc]);
                        }
                    }
                }
            }

            // Win check
            if (revealed === ROWS * COLS - MINES) {
                gameOver = true;
                clearInterval(timerInterval);
                document.getElementById('message').textContent = 'üéâ „ÇØ„É™„Ç¢ÔºÅ';
            }
        }

        function toggleFlag(r, c) {
            if (gameOver) return;
            const cell = grid[r][c];
            if (cell.revealed) return;

            startTimer();
            const el = document.getElementById(`cell-${r}-${c}`);

            if (cell.flagged) {
                cell.flagged = false;
                flagged--;
                el.classList.remove('flagged');
            } else {
                cell.flagged = true;
                flagged++;
                el.classList.add('flagged');
            }
            document.getElementById('mineCount').textContent = MINES - flagged;
        }

        function revealAllMines() {
            for (let r = 0; r < ROWS; r++) {
                for (let c = 0; c < COLS; c++) {
                    if (grid[r][c].mine) {
                        const el = document.getElementById(`cell-${r}-${c}`);
                        el.classList.add('revealed', 'mine');
                        el.textContent = 'üí£';
                    }
                }
            }
        }

        initGame();
    </script>
</body>
</html>
